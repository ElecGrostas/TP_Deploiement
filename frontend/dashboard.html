<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Supervision – Dashboard</title>

  <!-- Styles -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="./css/style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .chart-card {
      min-height: 320px;
    }
  </style>
</head>

<body>

<nav class="navbar navbar-expand-lg shadow-sm">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="./index.html">
      <img src="./img/hub-logo.png" alt="logo" style="height:26px; border-radius:4px;">
      <span>Supervision</span>
    </a>

    <div class="navbar-nav">
      <a class="nav-link" href="./config.html">Configuration</a>
      <a class="nav-link active" href="./dashboard.html">Dashboard</a>
      <a class="nav-link" href="./export.html">Export</a>
      <a class="nav-link" href="./ecriture.html">Écriture</a>
      <a class="nav-link" href="./aide.html">Aide</a>
    </div>
  </div>
</nav>

<main class="container py-4">

  <!-- ===== TITRE ===== -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">Supervision temps réel</h2>
      <p class="small-muted mb-0">Suivi des automates, variables et alertes.</p>
    </div>

    <div class="text-end small-muted">
      Dernière mise à jour : <span id="lastUpdate">--:--:--</span>
    </div>
  </div>

  <!-- ===== KPI ===== -->
<div class="row g-3 mb-4">
  <div class="col-6 col-lg-3">
    <div class="card h-100">
      <span class="small-muted">Automates</span>
      <h3 id="kpiAutomates">--</h3>
      <p id="kpiAutomatesDetail" class="small-muted">Chargement...</p>
    </div>
  </div>

  <div class="col-6 col-lg-3">
    <div class="card h-100">
      <span class="small-muted">Variables surveillées</span>
      <h3 id="kpiVariables">--</h3>
      <p id="kpiVariablesDetail" class="small-muted">Chargement...</p>
    </div>
  </div>

  <div class="col-6 col-lg-3">
    <div class="card h-100">
      <span class="small-muted">Alarmes actives</span>
      <h3 id="kpiAlarms">--</h3>
      <p class="small-muted">Dépassement de seuils</p>
    </div>
  </div>

  <div class="col-6 col-lg-3">
    <div class="card h-100">
      <span class="small-muted">Fréquence</span>
      <h3 id="kpiRefresh">--</h3>
      <p class="small-muted">Intervalle de mise à jour</p>
    </div>
  </div>
</div>


  <!-- ===== ETAT AUTOMATES ===== -->
  <div class="row g-3 mb-4">
    <div class="col-lg-4">
      <div class="card h-100">
        <h5 class="mb-2">État des automates</h5>
        <p class="small-muted">Connexion / Détectés</p>
        <div id="automatesStatus" class="vstack gap-2">
          <!-- JS remplira ici -->
        </div>
      </div>
    </div>

    <!-- ===== TABLE ALARMES ===== -->
    <div class="col-lg-8">
      <div class="card h-100">
        <h5 class="mb-2">Alarmes & événements</h5>
        <div class="table-responsive">
          <table class="table table-dark table-sm mb-0">
            <thead>
              <tr>
                <th>Heure</th>
                <th>Variable</th>
                <th>Valeur</th>
                <th>État</th>
              </tr>
            </thead>
            <tbody id="alarmsTableBody">
              <!-- alarmes injectées ici -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================= -->
  <!-- ===== ZONE GRAPHIQUES ==== -->
  <!-- ========================= -->

  <section class="mt-4">

    <!-- EN-TÊTE ET SÉLECTEUR -->
    <div class="card p-3 mb-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h4 class="mb-1">Graphiques temps réel</h4>
          <p class="small-muted mb-0">Suivi multi-variables en temps réel.</p>
        </div>

        <div class="d-flex gap-2">
          <select id="varSelect" class="form-select form-select-sm">
            <option value="">Sélectionner une variable...</option>
          </select>

          <button id="addChartBtn" class="btn btn-primary btn-sm">
            Ajouter un graphe
          </button>
        </div>
      </div>
    </div>

    <!-- CONTENEUR DES GRAPHIQUES (2 par ligne) -->
    <div id="chartsContainer" class="row g-3">
      <!-- JS va injecter des .col-lg-6 -->
    </div>

  </section>

  <p class="small-muted text-center mt-4">© 2025 – Supervision industrielle</p>

</main>

<script src="./js/api.js"></script>
<script src="./js/dashboard.js"></script>

</body>
</html>
