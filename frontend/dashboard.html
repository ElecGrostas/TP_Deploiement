<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Supervision – Dashboard</title>

  <!-- Bootstrap + DA globale -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="./css/style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<nav class="navbar navbar-expand-lg shadow-sm">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="./index.html">
      <img src="./img/hub-logo.png" alt="logo" style="height:26px; border-radius:4px;">
      <span>Supervision</span>
    </a>
    <div class="navbar-nav">
      <a class="nav-link" href="./config.html">Configuration</a>
      <a class="nav-link active" href="./dashboard.html">Dashboard</a>
      <a class="nav-link" href="./export.html">Export</a>
      <a class="nav-link" href="./ecriture.html">Écriture</a>
      <a class="nav-link" href="./aide.html">Aide</a>
    </div>
  </div>
</nav>

<main class="container py-4">

  <!-- Titre + sous-titre -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">Supervision temps réel</h2>
      <p class="small-muted mb-0">
        Vue d’ensemble des automates, variables critiques et tendances en temps réel.
      </p>
    </div>
    <div class="text-end small-muted">
      Dernière mise à jour : <span id="lastUpdate">--:--:--</span>
    </div>
  </div>

  <!-- Bandeau KPI -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-lg-3">
      <div class="card h-100">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <span class="small-muted">Automates</span>
          <span class="badge-soft">Statut</span>
        </div>
        <h3 id="kpiAutomates" class="mb-1">0</h3>
        <p class="small-muted mb-0" id="kpiAutomatesDetail">Aucun automate configuré</p>
      </div>
    </div>

    <div class="col-6 col-lg-3">
      <div class="card h-100">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <span class="small-muted">Variables surveillées</span>
        </div>
        <h3 id="kpiVariables" class="mb-1">0</h3>
        <p class="small-muted mb-0" id="kpiVariablesDetail">Total variables configurées</p>
      </div>
    </div>

    <div class="col-6 col-lg-3">
      <div class="card h-100">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <span class="small-muted">Alarmes actives</span>
        </div>
        <h3 id="kpiAlarms" class="mb-1">0</h3>
        <p class="small-muted mb-0">Seuils dépassés / états critiques</p>
      </div>
    </div>

    <div class="col-6 col-lg-3">
      <div class="card h-100">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <span class="small-muted">Fréquence de rafraîchissement</span>
        </div>
        <h3 id="kpiRefresh" class="mb-1">2 s</h3>
        <p class="small-muted mb-0">Intervalle de lecture temps réel</p>
      </div>
    </div>
  </div>

  <!-- Ligne principale : graphe global + état automates -->
  <div class="row g-3 mb-4">

    <!-- Graphe global -->
    <div class="col-lg-8">
      <div class="card chart-card h-100 d-flex flex-column">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h5 class="mb-1">Tendance globale</h5>
            <p class="small-muted mb-0">
              Suivi en temps réel de la variable sélectionnée.
            </p>
          </div>
          <div class="d-flex gap-2">
            <select id="mainVarSelect" class="form-select form-select-sm">
              <option value="">Variable principale...</option>
            </select>
            <button id="refreshMainChart" class="btn btn-secondary btn-sm">
              Rafraîchir
            </button>
          </div>
        </div>

        <div class="flex-grow-1">
          <canvas id="mainChart" height="120"></canvas>
        </div>
      </div>
    </div>

    <!-- État automates -->
    <div class="col-lg-4">
      <div class="card h-100">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">État des automates</h5>
          <span class="small-muted">Ping / communication</span>
        </div>
        <div id="automatesStatus" class="vstack gap-2">
          <!-- Rempli par dashboard.js -->
        </div>
      </div>
    </div>

  </div>

  <!-- Ligne secondaire : synoptique + multi-graphiques + seuils -->
  <div class="row g-3 mb-4">
    <!-- Synoptique process -->
    <div class="col-lg-5">
      <div class="card h-100">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Synoptique process</h5>
          <span class="small-muted">État global</span>
        </div>

        <div class="synoptic-wrapper">
          <!-- Ligne "production" -->
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="synoptic-block">
              <div class="synoptic-title">Entrée</div>
              <div class="synoptic-value" id="synInFlow">--</div>
              <div class="small-muted">Débit / charge</div>
            </div>
            <div class="synoptic-arrow">➜</div>
            <div class="synoptic-block">
              <div class="synoptic-title">Traitement</div>
              <div class="synoptic-value" id="synProcessTemp">-- °C</div>
              <div class="small-muted">Température / process</div>
            </div>
            <div class="synoptic-arrow">➜</div>
            <div class="synoptic-block">
              <div class="synoptic-title">Sortie</div>
              <div class="synoptic-value" id="synOutQuality">--</div>
              <div class="small-muted">Qualité / état</div>
            </div>
          </div>

          <!-- Ligne "états" -->
          <div class="mt-3">
            <div class="d-flex justify-content-between">
              <div class="d-flex align-items-center gap-2">
                <span class="status-dot status-ok"></span>
                <span class="small-muted">Production</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <span class="status-dot status-warn"></span>
                <span class="small-muted">Avertissement</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <span class="status-dot status-alarm"></span>
                <span class="small-muted">Alarme</span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Multi-graphiques / seuils / configuration dynamique -->
    <div class="col-lg-7">
      <div class="card h-100 d-flex flex-column">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h5 class="mb-1">Graphiques temps réel</h5>
            <p class="small-muted mb-0">
              Ajoutez des graphes et des seuils critiques pour générer des alarmes.
            </p>
          </div>
          <div class="d-flex gap-2">
            <select id="varSelect" class="form-select form-select-sm">
              <option value="">Sélectionner une variable...</option>
            </select>
            <button id="addChartBtn" class="btn btn-primary btn-sm">
              Ajouter un graphe
            </button>
          </div>
        </div>

        <!-- Config seuils pour la variable sélectionnée -->
        <div class="border rounded-3 p-2 mb-3 bg-dark-subtle">
          <div class="d-flex flex-wrap justify-content-between align-items-center mb-2">
            <div>
              <span class="small-muted d-block">Seuils critiques</span>
              <span class="small-muted">
                Appliqués à la variable sélectionnée ci-dessus.
              </span>
            </div>
            <div class="d-flex flex-wrap gap-2 align-items-end">
              <div>
                <label class="small d-block mb-1">Seuil bas</label>
                <input type="number" step="any" id="thresholdLow" class="form-control form-control-sm" placeholder="Min">
              </div>
              <div>
                <label class="small d-block mb-1">Seuil haut</label>
                <input type="number" step="any" id="thresholdHigh" class="form-control form-control-sm" placeholder="Max">
              </div>
              <div>
                <label class="small d-block mb-1">Type</label>
                <select id="thresholdType" class="form-select form-select-sm">
                  <option value="both">Min & Max</option>
                  <option value="min">Min uniquement</option>
                  <option value="max">Max uniquement</option>
                </select>
              </div>
              <button id="addThresholdBtn" class="btn btn-warning btn-sm ms-1">
                Ajouter seuil
              </button>
            </div>
          </div>

          <div class="small-muted mb-1">
            Seuils configurés pour la variable sélectionnée :
          </div>
          <ul id="thresholdsList" class="list-unstyled mb-0 small">
            <!-- Rempli par dashboard.js : liste des seuils (min / max) pour la variable en cours -->
          </ul>
        </div>

        <div id="chartsContainer" class="row g-3 flex-grow-1">
          <!-- dashboard.js viendra ajouter des colonnes de graphe ici :
          <div class="col-md-6" id="chart-col-<id>">
            <div class="card chart-card">
              <div class="d-flex justify-content-between align-items-center mb-2 px-3 pt-2">
                <div class="small-muted">Nom variable</div>
                <button class="btn btn-sm btn-outline-light">×</button>
              </div>
              <canvas id="chart-<id>"></canvas>
            </div>
          </div>
          -->
        </div>
      </div>
    </div>
  </div>

  <!-- Alarme / historique événements récents -->
  <div class="row g-3 mb-4">
    <div class="col-12">
      <div class="card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Alarmes & événements récents</h5>
          <button id="refreshAlarms" class="btn btn-secondary btn-sm">
            Rafraîchir
          </button>
        </div>

        <div class="table-responsive">
          <table class="table table-dark table-sm align-middle">
            <thead>
              <tr>
                <th>Horodatage</th>
                <th>Automate</th>
                <th>Variable</th>
                <th>Valeur</th>
                <th>Seuil</th>
                <th>Statut</th>
              </tr>
            </thead>
            <tbody id="alarmsBody">
              <!-- Rempli par dashboard.js lors des dépassements de seuil -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <p class="small-muted mt-4 text-center">
    © 2025 – L'Interface de supervision la plus chaude de ta région • Dashboard temps réel
  </p>

</main>

<!-- JS globaux -->
<script src="./js/api.js"></script>
<script src="./js/dashboard.js"></script>

</body>
</html>
